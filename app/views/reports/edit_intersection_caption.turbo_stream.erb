<%= turbo_stream.replace "modal" do %>
  <%= turbo_frame_tag :modal do %>
    <%= render ModalComponent.new(
      header: "Edit Intersection Caption",
      id: "caption-modal",
      controller: "modal",
      size: "md",
      open: true
    ) do |m| %>

      <%= form_with url: intersection_captions_report_path(@report),
                    method: :post,
                    local: false,
                    data: {
                      modal_target: 'form',
                      turbo: true,
                      turbo_frame: '_top'
                    },
                    id: "caption-form" do |f| %>

        <%= hidden_field_tag :intersection_id, @intersection_id %>

        <div id="caption-form-errors"></div>

        <div class="mb-4">
          <label for="caption" class="block text-sm font-medium text-gray-700 mb-2">
            Caption (max 50 characters)
          </label>
          <%= text_field_tag :caption,
                             @current_caption,
                             maxlength: 50,
                             class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",
                             placeholder: "Enter caption for intersection...",
                             data: { modal_target: 'focusInput' } %>
          <div class="flex justify-between items-center mt-1">
            <span class="text-xs text-gray-500">Leave blank to remove caption</span>
            <span class="text-xs text-gray-500" id="caption-counter">
              <%= @current_caption.length %>/50
            </span>
          </div>
        </div>

        <% m.with_actions do %>
          <%= render FormModalActionsComponent.new %>
        <% end %>
      <% end %>

    <% end %>
  <% end %>
<% end %>
